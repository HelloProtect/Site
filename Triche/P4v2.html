<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puissance 4 Imbattable</title>
    <style>
        body { font-family: sans-serif; background: #0f172a; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 100vh; margin: 0; }
        #board { display: grid; grid-template-columns: repeat(7, 60px); grid-template-rows: repeat(6, 60px); gap: 8px; background: #1e40af; padding: 15px; border-radius: 15px; }
        .cell { width: 60px; height: 60px; background: #020617; border-radius: 50%; cursor: pointer; }
        .player { background: radial-gradient(circle, #f87171, #b91c1c); }
        .bot { background: radial-gradient(circle, #fde047, #ca8a04); }
        .controls { margin-bottom: 20px; }
        /* Barre de probabilité */
        .win-chance-container { width: 300px; height: 20px; background: #334155; border-radius: 10px; margin: 20px 0; overflow: hidden; border: 2px solid #fff; }
        #win-bar { width: 50%; height: 100%; background: linear-gradient(90deg, #f87171, #fde047); transition: width 0.5s ease; }
        #win-text { font-weight: bold; margin-bottom: 5px; }
    </style>
</head>
<body>

    <h1>Puissance 4 Alpha-Beta</h1>

    <div class="controls">
        <select id="startPlayer" onchange="resetGame()">
            <option value="1">Tu commences</option>
            <option value="2">Le Bot commence</option>
        </select>
        <button onclick="resetGame()">Reset</button>
    </div>

    <div id="win-text">Chance de gagner : 50%</div>
    <div class="win-chance-container"><div id="win-bar"></div></div>

    <div id="board"></div>
    <div id="status">À ton tour</div>

<script>
    const ROWS = 6, COLS = 7;
    let board = [], gameOver = false;

    function initBoard() {
        board = Array(ROWS).fill().map(() => Array(COLS).fill(0));
        gameOver = false;
        const boardDiv = document.getElementById("board");
        boardDiv.innerHTML = "";
        for (let i = 0; i < ROWS * COLS; i++) {
            const cell = document.createElement("div");
            cell.classList.add("cell");
            cell.dataset.col = i % COLS;
            cell.onclick = () => { if(currentPlayer === 1) handleMove(parseInt(cell.dataset.col)); };
            boardDiv.appendChild(cell);
        }
        currentPlayer = parseInt(document.getElementById("startPlayer").value);
        if (currentPlayer === 2) setTimeout(botMove, 500);
        updateUI();
    }

    function handleMove(col) {
        if (gameOver || !dropPiece(col, 1)) return;
        if (checkWin(board, 1)) return end("Gagné !");
        currentPlayer = 2;
        updateUI();
        setTimeout(botMove, 300);
    }

    function botMove() {
        if (gameOver) return;
        let col = findBestMove();
        dropPiece(col, 2);
        if (checkWin(board, 2)) return end("Le Bot est imbattable !");
        if (board[0].every(c => c !== 0)) return end("Match nul");
        currentPlayer = 1;
        updateUI();
    }

    function dropPiece(col, p) {
        for (let r = ROWS - 1; r >= 0; r--) {
            if (board[r][col] === 0) { board[r][col] = p; render(); return true; }
        }
        return false;
    }

    function findBestMove() {
        let bestScore = -Infinity, bestCol = 3;
        for (let c of [3,2,4,1,5,0,6]) {
            let r = getRow(board, c);
            if (r !== -1) {
                board[r][c] = 2;
                let score = minimax(board, 8, false, -Infinity, Infinity);
                board[r][c] = 0;
                if (score > bestScore) { bestScore = score; bestCol = c; }
            }
        }
        return bestCol;
    }

    function minimax(node, depth, isMax, alpha, beta) {
        if (checkWin(node, 2)) return 100000;
        if (checkWin(node, 1)) return -100000;
        if (depth === 0) return evaluate(node);

        if (isMax) {
            let v = -Infinity;
            for (let c = 0; c < COLS; c++) {
                let r = getRow(node, c);
                if (r !== -1) {
                    node[r][c] = 2;
                    v = Math.max(v, minimax(node, depth - 1, false, alpha, beta));
                    node[r][c] = 0;
                    alpha = Math.max(alpha, v);
                    if (beta <= alpha) break;
                }
            }
            return v;
        } else {
            let v = Infinity;
            for (let c = 0; c < COLS; c++) {
                let r = getRow(node, c);
                if (r !== -1) {
                    node[r][c] = 1;
                    v = Math.min(v, minimax(node, depth - 1, true, alpha, beta));
                    node[r][c] = 0;
                    beta = Math.min(beta, v);
                    if (beta <= alpha) break;
                }
            }
            return v;
        }
    }

    function evaluate(b) {
        let score = 0;
        // Priorité énorme au centre
        for(let r=0; r<6; r++) if(b[r][3]===2) score += 10;
        return score;
    }

    function updateUI() {
        let score = minimax(board, 4, false, -Infinity, Infinity);
        // Conversion score en % (approximatif)
        let chance = Math.max(5, Math.min(95, 50 - (score / 100)));
        document.getElementById("win-bar").style.width = chance + "%";
        document.getElementById("win-text").textContent = `Ta chance de gagner : ${Math.round(chance)}%`;
        render();
    }

    function checkWin(b, p) {
        for (let r=0; r<6; r++) for (let c=0; c<4; c++) if (b[r][c]===p && b[r][c+1]===p && b[r][c+2]===p && b[r][c+3]===p) return true;
        for (let r=0; r<3; r++) for (let c=0; c<7; c++) if (b[r][c]===p && b[r+1][c]===p && b[r+2][c]===p && b[r+3][c]===p) return true;
        for (let r=0; r<3; r++) for (let c=0; c<4; c++) if (b[r][c]===p && b[r+1][c+1]===p && b[r+2][c+2]===p && b[r+3][c+3]===p) return true;
        for (let r=3; r<6; r++) for (let c=0; c<4; c++) if (b[r][c]===p && b[r-1][c+1]===p && b[r-2][c+2]===p && b[r-3][c+3]===p) return true;
        return false;
    }

    function getRow(b, c) { for (let r = 5; r >= 0; r--) if (b[r][c] === 0) return r; return -1; }
    function render() {
        const cells = document.querySelectorAll(".cell");
        board.flat().forEach((v, i) => { cells[i].className = "cell" + (v===1?" player":v===2?" bot":""); });
    }
    function end(m) { document.getElementById("status").textContent = m; gameOver = true; }
    function resetGame() { initBoard(); }

    initBoard();
</script>
</body>
</html>

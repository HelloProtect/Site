<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Message Sécurisé</title>
    <style>
        body { font-family: 'Inter', sans-serif; background: #0a0a0c; color: #e2e8f0; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: #111114; padding: 2.5rem; border-radius: 20px; border: 1px solid #27272a; text-align: center; width: 100%; max-width: 400px; }
        input { width: 100%; padding: 12px; margin: 8px 0; background: #1c1c21; border: 1px solid #3f3f46; border-radius: 8px; color: white; box-sizing: border-box; }
        button { width: 100%; background: #ffffff; color: #000; border: none; padding: 12px; margin-top: 10px; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .link-box { margin-top: 15px; font-size: 0.75rem; color: #3b82f6; word-wrap: break-word; cursor: pointer; }
        .expired { color: #ef4444; }
    </style>
</head>
<body>

<div class="card">
    <div id="view" style="display: none;">
        <h2 id="msg-display">Message Verrouillé</h2>
        <input type="password" id="pass-verify" placeholder="Mot de passe">
        <button onclick="unlock()">Déverrouiller</button>
        <p id="error" style="color:#ef4444; font-size: 0.8rem;"></p>
        <a href="?" style="color: #64748b; font-size: 0.8rem; text-decoration: none;">← Accueil</a>
    </div>

    <div id="create">
        <h2>Créer un message</h2>
        <input type="text" id="msg" placeholder="Votre message secret">
        <input type="password" id="pass" placeholder="Mot de passe">
        <select id="duration" style="width:100%; padding:10px; border-radius:8px; background:#1c1c21; color:white; border:1px solid #3f3f46;">
            <option value="1">Expire dans 1 minute</option>
            <option value="60">Expire dans 1 heure</option>
            <option value="1440">Expire dans 1 jour</option>
        </select>
        <button onclick="generate()">Générer le lien sécurisé</button>
        <div id="result" class="link-box"></div>
    </div>
</div>

<script>
    const hash = window.location.hash.substring(1);
    if (hash) {
        document.getElementById('create').style.display = 'none';
        document.getElementById('view').style.display = 'block';
    }

    function generate() {
        const msg = document.getElementById('msg').value;
        const pass = document.getElementById('pass').value;
        const dur = document.getElementById('duration').value;
        
        if (!msg || !pass) return alert("Remplissez tout !");

        const expiry = Date.now() + (dur * 60000);
        const data = JSON.stringify({ m: msg, p: pass, e: expiry });
        const url = window.location.origin + window.location.pathname + "#" + btoa(unescape(encodeURIComponent(data)));
        
        document.getElementById('result').innerText = url;
    }

    function unlock() {
        try {
            const data = JSON.parse(decodeURIComponent(escape(atob(hash))));
            const inputPass = document.getElementById('pass-verify').value;

            if (Date.now() > data.e) {
                document.getElementById('error').innerText = "Ce lien a expiré.";
                return;
            }
            if (inputPass === data.p) {
                document.getElementById('view').innerHTML = `<h1>${data.m}</h1><a href="?" style="color: #64748b; text-decoration: none;">← Retour</a>`;
            } else {
                document.getElementById('error').innerText = "Mot de passe incorrect.";
            }
        } catch(e) { alert("Lien corrompu"); }
    }
</script>
</body>
</html>

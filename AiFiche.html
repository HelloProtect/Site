<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghost-Vault | Ultra-Safe</title>
    <style>
        :root { --accent: #0070f3; --bg: #050505; }
        body { font-family: sans-serif; background: var(--bg); color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: #111; padding: 2rem; border-radius: 12px; border: 1px solid #333; width: 90%; max-width: 400px; text-align: center; }
        input, select, button { width: 100%; padding: 12px; margin: 8px 0; border-radius: 6px; border: 1px solid #333; background: #000; color: white; }
        button { background: var(--accent); border: none; font-weight: bold; cursor: pointer; }
        #out { font-size: 10px; color: var(--accent); word-break: break-all; margin-top: 15px; cursor: pointer; border: 1px dashed #333; padding: 10px; min-height: 20px; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="card">
    <div id="view" class="hidden">
        <h1>Accès Sécurisé</h1>
        <input type="password" id="pv" placeholder="Mot de passe">
        <button onclick="unlock()">DÉCHIFFRER</button>
    </div>

    <div id="create">
        <h1>Ghost-Vault</h1>
        <select id="t" onchange="toggle()">
            <option value="m">Message</option>
            <option value="u">Lien (Redirection)</option>
            <option value="f">Fichier</option>
        </select>
        <input type="text" id="m" placeholder="Contenu...">
        <input type="file" id="fi" class="hidden">
        <input type="password" id="p" placeholder="Mot de passe">
        <button onclick="gen()">GÉNÉRER LE LIEN</button>
        <div id="out" onclick="copy()"></div>
    </div>
</div>

<script>
    const h = window.location.hash.substring(1);
    if(h) {
        document.getElementById('create').classList.add('hidden');
        document.getElementById('view').classList.remove('hidden');
    }

    function toggle() {
        const isF = document.getElementById('t').value === 'f';
        document.getElementById('m').classList.toggle('hidden', isF);
        document.getElementById('fi').classList.toggle('hidden', !isF);
    }

    // Encodage UTF-8 vers Base64
    function utob(str) {
        return btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (match, p1) => String.fromCharCode('0x' + p1)));
    }

    // Décodage Base64 vers UTF-8
    function btou(str) {
        return decodeURIComponent(Array.prototype.map.call(atob(str), c => '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2)).join(''));
    }

    async function gen() {
        const type = document.getElementById('t').value;
        let content = (type === 'f') ? 
            await new Promise(r => { const rd = new FileReader(); rd.onload=()=>r(rd.result); rd.readAsDataURL(document.getElementById('fi').files[0]); }) : 
            document.getElementById('m').value;

        const data = utob(JSON.stringify({t: type, c: content, p: document.getElementById('p').value}));
        document.getElementById('out').innerText = window.location.origin + window.location.pathname + "#" + data;
    }

    function unlock() {
        try {
            const d = JSON.parse(btou(h));
            if(document.getElementById('pv').value !== d.p) return alert("Mauvais mot de passe");
            
            if(d.t === 'u') window.location.href = d.c;
            else if(d.t === 'f') { const a = document.createElement('a'); a.href = d.c; a.download = "ghost_file"; a.click(); }
            else document.body.innerHTML = `<h1 style="color:white;text-align:center;margin-top:20%">${d.c}</h1>`;
        } catch(e) { alert("Erreur de décodage. Le lien est peut-être coupé."); }
    }

    function copy() {
        navigator.clipboard.writeText(document.getElementById('out').innerText);
        alert("Lien copié !");
    }
</script>
</body>
</html>
